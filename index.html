<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="public/styles/style.css" />
  </head>
  <body>
    <div class="TD">
      <div class="div">
        <div id="boxA" class="overlap-2" data-estado="carregando" data-letra="A">
          <div class="div-2 carregando"></div>
          <div class="text-wrapper-9">A</div>
          <div class="text-wrapper-8">Carregando</div>
          <img class="union-4" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-5.svg" />
          <img class="union-5" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-2.svg" />
          <img class="union-6" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-7.svg" />
          <img class="union-7" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-3.svg" />
          <div class="rectangle-5"></div>
          <div class="rectangle-6"></div>
          <div class="rectangle-7"></div>
          <div class="rectangle-8"></div>
          <div class="text-wrapper-10 data-min">102 min</div>
          <div class="text-wrapper-11 data-kw">39 Kw</div>
          <div class="text-wrapper-12 data-multa">R$ 0,00</div>
          <div class="text-wrapper-13 data-total">R$ 113,10</div>
        </div>

        <div id="boxB" class="overlap" data-estado="disponivel" data-letra="B">
          <div class="div-2 disponivel"></div>
          <div class="text-wrapper">B</div>
          <div class="text-wrapper-7">Dispon√≠vel</div>
        </div>

        <div id="boxC" class="overlap-group" data-estado="carregado" data-letra="C">
          <div class="carregado carregado"></div>
          <div class="text-wrapper">C</div>
          <div class="text-wrapper-2">Carregado</div>
          <img class="union" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-6.svg" />
          <img class="img" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-4.svg" />
          <img class="union-2" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union-1.svg" />
          <img class="union-3" src="https://c.animaapp.com/mbk8p19zDgDFlH/img/union.svg" />
          <div class="rectangle"></div>
          <div class="rectangle-2"></div>
          <div class="rectangle-3"></div>
          <div class="rectangle-4"></div>
          <div class="text-wrapper-3 data-min">150 min</div>
          <div class="text-wrapper-4 data-kw">54 Kw</div>
          <div class="text-wrapper-5 data-multa">R$ 15,00</div>
          <div class="text-wrapper-6 data-total">R$ 156,60</div>
        </div>

        <div class="loading-icons">
             <svg xmlns="http://www.w3.org/2000/svg" width="207" height="211" viewBox="0 0 207 211" fill="none">
                <rect x="37.085" y="33.9327" width="37.0847" height="33.9327" rx="5" transform="rotate(180 37.085 33.9327)" fill="#4DE53F" fill-opacity="0.59"/>
                <rect x="153.059" y="116.605" width="37.0847" height="33.9327" rx="5" transform="rotate(180 153.059 116.605)" fill="#5CE53A" fill-opacity="0.8"/>
                <rect x="115.974" y="174.599" width="37.0847" height="33.9327" rx="5" transform="rotate(180 115.974 174.599)" fill="#B7E3AC" fill-opacity="0.8"/>
                <rect x="104.512" y="53.6754" width="37.0847" height="33.9327" rx="5" transform="rotate(180 104.512 53.6754)" fill="#5FC540" fill-opacity="0.8"/>
                <rect x="55.9639" y="119.073" width="37.0847" height="33.9327" rx="5" transform="rotate(180 55.9639 119.073)" fill="#1FAD28" fill-opacity="0.8"/>
                <rect x="51.9189" y="211" width="37.0847" height="33.9327" rx="5" transform="rotate(180 51.9189 211)" fill="#7ADA74"/>
                <rect x="207" y="47.5059" width="37.0847" height="33.9327" rx="5" transform="rotate(180 207 47.5059)" fill="#9EEF8A" fill-opacity="0.8"/>
            </svg>
        </div>
        <div class="loading-icons2">
             <svg xmlns="http://www.w3.org/2000/svg" width="207" height="211" viewBox="0 0 207 211" fill="none">
                <rect x="169.915" y="177.067" width="37.0847" height="33.9327" rx="5" fill="#4DE53F" fill-opacity="0.59"/>
                <rect x="53.9414" y="94.3947" width="37.0847" height="33.9327" rx="5" fill="#5CE53A" fill-opacity="0.8"/>
                <rect x="91.0264" y="36.4006" width="37.0847" height="33.9327" rx="5" fill="#B7E3AC" fill-opacity="0.8"/>
                <rect x="102.488" y="157.325" width="37.0847" height="33.9327" rx="5" fill="#5FC540" fill-opacity="0.8"/>
                <rect x="151.036" y="91.9269" width="37.0847" height="33.9327" rx="5" fill="#1FAD28" fill-opacity="0.8"/>
                <rect x="155.081" width="37.0847" height="33.9327" rx="5" fill="#7ADA74"/>
                <rect y="163.494" width="37.0847" height="33.9327" rx="5" fill="#9EEF8A" fill-opacity="0.8"/>
            </svg>
        </div>
        <div class="text-wrapper-14">SAC: 0800 000 1111</div>
        <div class="overlap-3">...</div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const fetchChargerStatus = async () => {
          try {
            const response = await fetch('/api/chargers');
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const chargers = await response.json();
            updateChargerUI(chargers);
          } catch (error) {
            console.error('Falha ao buscar status do carregador:', error);
            }
        };

        const updateChargerUI = (chargers) => {
          chargers.forEach(charger => {
            const box = document.getElementById(charger.id);
            if (box) {
              box.setAttribute('data-estado', charger.status);
              const divColor = box.querySelector('.div-2, .carregado');
              if (divColor) {
                divColor.classList.remove('carregando', 'disponivel', 'carregado');
                divColor.classList.add(charger.status);
              }

              if (charger.details) {
                const minElement = box.querySelector('.data-min');
                const kwElement = box.querySelector('.data-kw');
                const multaElement = box.querySelector('.data-multa');
                const totalElement = box.querySelector('.data-total');

                if (minElement) minElement.textContent = `${charger.details.min} min`;
                if (kwElement) kwElement.textContent = `${charger.details.kw} Kw`;
                if (multaElement) multaElement.textContent = `R$ ${charger.details.multa.toFixed(2).replace('.', ',')}`;
                if (totalElement) totalElement.textContent = `R$ ${charger.details.total.toFixed(2).replace('.', ',')}`;

              } else {
                const detailElements = box.querySelectorAll(
                    '.union, .img, .union-2, .union-3, .union-4, .union-5, .union-6, .union-7, ' +
                    '.rectangle, .rectangle-2, .rectangle-3, .rectangle-4, .rectangle-5, .rectangle-6, .rectangle-7, .rectangle-8, ' +
                    '.data-min, .data-kw, .data-multa, .data-total, .text-wrapper-3, .text-wrapper-4, .text-wrapper-5, .text-wrapper-6, ' +
                    '.text-wrapper-10, .text-wrapper-11, .text-wrapper-12, .text-wrapper-13'
                );
                detailElements.forEach(el => el.style.display = 'none');
              }
            }
          });
        };

        const gerenciarEstado = (box) => {
          const estado = box.getAttribute('data-estado');
          const letra = box.getAttribute('data-letra');

          switch(estado) {
            case 'carregando':
              alert('Carregador ocupado!');
              break;
            case 'disponivel':
              sessionStorage.setItem('selectedTotem', letra); 
              window.location.href = 'htmls/termos.html';
              break;
            case 'carregado':
              alert('Recarga encerrada! Remova o carregador!');
              break;
          }
        };

        document.querySelectorAll('#boxA, #boxB, #boxC').forEach(box => {
          box.addEventListener('click', () => gerenciarEstado(box));
        });
        fetchChargerStatus();
      });
    </script>
  </body>
</html>